<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Watchkeeper Console</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="topbar">
    <div class="brand-block">
      <h1>Watchkeeper vNext</h1>
      <p class="brand-sub">Bridge Watch Panel</p>
    </div>
    <div class="bridge-panel">
      <div class="bridge-cell">
        <span class="bridge-label">Watch Condition</span>
        <span id="watchTier" class="bridge-value tier-normal">NORMAL</span>
        <span id="watchCondition" class="bridge-sub">STANDBY</span>
        <span class="bridge-label bridge-label-inline">Mode</span>
        <span id="watchMode" class="bridge-sub">STANDBY</span>
      </div>
      <div class="bridge-cell">
        <span class="bridge-label">AI Advisory</span>
        <span id="advisoryStatus" class="bridge-value status-offline">offline</span>
        <span id="advisoryLatency" class="bridge-sub">-</span>
      </div>
      <div class="bridge-cell">
        <span class="bridge-label">Vector</span>
        <span id="vectorStatus" class="bridge-value status-offline">offline</span>
        <span id="vectorLatency" class="bridge-sub">-</span>
      </div>
      <div class="bridge-cell">
        <span class="bridge-label">Last Alarm</span>
        <span id="lastAlarmTs" class="bridge-value">none</span>
        <span id="lastAlarmMeta" class="bridge-sub">-</span>
      </div>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-btn active" data-tab="console">Console</button>
    <button class="tab-btn" data-tab="status">Stack Status</button>
    <button class="tab-btn" data-tab="logs">Logs & Diagnostics</button>
  </nav>

  <main>
    <section id="tab-console" class="tab-panel active">
      <div class="console-grid">
        <div class="console-main">
          <div class="panel">
            <label for="modeSelect">Mode</label>
            <select id="modeSelect">
              <option value="game">game</option>
              <option value="work">work</option>
              <option value="standby" selected>standby</option>
              <option value="tutor">tutor</option>
            </select>
          </div>
          <div class="panel">
            <div class="row response-head">
              <h2>Response</h2>
              <button id="copyResponseBtn" class="secondary">Copy Response</button>
            </div>
            <div class="row incident-row">
              <span class="muted">Incident:</span>
              <code id="incidentId" class="incident-id">-</code>
              <button id="copyIncidentBtn" class="secondary">Copy Incident ID</button>
              <button id="openIncidentLogsBtn" class="secondary">Open in Logs</button>
            </div>
            <pre id="assistResponse" class="code response-box"></pre>
          </div>
          <div class="panel">
            <label for="promptInput">Prompt</label>
            <textarea id="promptInput" rows="6" placeholder="Ask Watchkeeper..."></textarea>
            <div class="row">
              <button id="sendAssistBtn">Send to /assist</button>
              <button id="clearPromptBtn" class="secondary">Clear</button>
              <button id="saveMacroBtn" class="secondary" disabled title="Reserved for later">Save as Macro</button>
              <span id="assistMeta" class="muted"></span>
            </div>
          </div>
        </div>
        <div class="console-side">
          <div class="panel">
            <h2>Quick SitRep</h2>
            <pre id="quickSitrep" class="code response-box"></pre>
          </div>
        </div>
      </div>
      <div class="panel">
        <h2>Policy Preview</h2>
        <div id="policyDemoRow" class="row policy-demo-row is-hidden">
          <label for="policyDemoSelect" class="policy-demo-label">Demo scenario</label>
          <select id="policyDemoSelect">
            <option value="none" selected>None (normal mode)</option>
            <option value="no_actions">Demo: No actions</option>
            <option value="needs_confirmation">Demo: Needs confirmation</option>
            <option value="denied">Demo: Denied</option>
            <option value="mixed">Demo: Mixed</option>
          </select>
        </div>
        <div id="policyPreview" class="policy-preview-list"></div>
      </div>
    </section>

    <section id="tab-status" class="tab-panel">
      <div class="panel">
        <h2>Services</h2>
        <div id="servicesTable"></div>
      </div>
      <div class="panel">
        <h2>Runtime</h2>
        <pre id="runtimeInfo" class="code"></pre>
      </div>
      <div class="panel">
        <h2>Handover / SitRep</h2>
        <pre id="handoverInfo" class="code"></pre>
      </div>
    </section>

    <section id="tab-logs" class="tab-panel">
      <div class="panel">
        <div class="row">
          <button id="refreshLogsBtn">Refresh</button>
          <button id="diagBundleBtn">Download Diag Bundle</button>
          <a id="diagBundleLink" href="#" target="_blank" rel="noopener"></a>
        </div>
      </div>
      <div class="panel">
        <h2>Log Files</h2>
        <div id="logFiles"></div>
      </div>
      <div class="panel">
        <h2>File Tail</h2>
        <pre id="logTail" class="code"></pre>
      </div>
      <div class="panel">
        <h2>Event Log (Live)</h2>
        <div id="logsFilter" class="muted"></div>
        <pre id="eventTail" class="code"></pre>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
